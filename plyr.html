<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>Plyr + hls.js Test</title>
    <script src="node_modules/hls.js/dist/hls.js"></script>
    <script src="node_modules/plyr/dist/plyr.js"></script>
    <script src="node_modules/plyr-resolution-selector/plyr-resolution-selector.js"></script>
    <link rel="stylesheet" href="css/hls.css">
    <link rel="stylesheet" href="node_modules/plyr/dist/plyr.css">
    <link rel="stylesheet" href="node_modules/plyr-resolution-selector/plyr-resolution-selector.css">
  </head>
  <body>
    <div class="box">
      <video id="video">
        <source res="380" src="https://video-dev.github.io/streams/x36xhzz/url_0/193039199_mp4_h264_aac_hd_7.m3u8" type="application/x-mpegURL" />
        <source res="240" src="https://video-dev.github.io/streams/x36xhzz/url_0/193039199_mp4_h264_aac_hd_7.m3u8" type="application/x-mpegURL" />
      </video>
    </div>
    <script>
      if(Hls.isSupported()) {
        var video = document.getElementById('video');
        var config = {
          startLevel: 0,
          maxBufferLength: 30,
          maxBufferSize: 30
        };
        var hls = new Hls(config);
        hls.loadSource('https://video-dev.github.io/streams/x36xhzz/x36xhzz.m3u8');
        hls.attachMedia(video);
        hls.loadLevel = 0;
        hls.on(Hls.Events.MANIFEST_PARSED,function() {
          console.log('loadlevel:' + hls.loadLevel);

var controls = ["<div class='plyr__controls'>",
    "<button type='button' data-plyr='play'>",
        "<svg><use xlink:href='#plyr-play'></use></svg>",
        "<span class='plyr__sr-only'>Play</span>",
    "</button>",
    "<button type='button' data-plyr='pause'>",
        "<svg><use xlink:href='#plyr-pause'></use></svg>",
        "<span class='plyr__sr-only'>Pause</span>",
    "</button>",
    "<span class='plyr__progress'>",
        "<label for='seek{id}' class='plyr__sr-only'>Seek</label>",
        "<input id='seek{id}' class='plyr__progress--seek' type='range' min='0' max='100' step='0.1' value='0' data-plyr='seek'>",
        "<progress class='plyr__progress--played' max='100' value='0' role='presentation'></progress>",
        "<progress class='plyr__progress--buffer' max='100' value='0'>",
            "<span>0</span>% buffered",
        "</progress>",
        "<span class='plyr__tooltip'>00:00</span>",
    "</span>",
    "<span class='plyr__time'>",
        "<span class='plyr__sr-only'>Current time</span>",
        "<span class='plyr__time--current'>00:00</span>",
    "</span>",
    "<span class='plyr__time'>",
        "<span class='plyr__sr-only'>Duration</span>",
        "<span class='plyr__time--duration'>00:00</span>",
    "</span>",
    "<button type='button' data-plyr='mute'>",
        "<svg class='icon--muted'><use xlink:href='#plyr-muted'></use></svg>",
        "<svg><use xlink:href='#plyr-volume'></use></svg>",
        "<span class='plyr__sr-only'>Toggle Mute</span>",
    "</button>",
    "<span class='plyr__volume'>",
        "<label for='volume{id}' class='plyr__sr-only'>Volume</label>",
        "<input id='volume{id}' class='plyr__volume--input' type='range' min='0' max='10' value='5' data-plyr='volume'>",
        "<progress class='plyr__volume--display' max='10' value='0' role='presentation'></progress>",
    "</span>",
    "<button type='button' data-plyr='captions'>",
        "<svg class='icon--captions-on'><use xlink:href='#plyr-captions-on'></use></svg>",
        "<svg><use xlink:href='#plyr-captions-off'></use></svg>",
        "<span class='plyr__sr-only'>Toggle Captions</span>",
    "</button>",
    "<button type='button' data-plyr='fullscreen'>",
        "<svg class='icon--exit-fullscreen'><use xlink:href='#plyr-exit-fullscreen'></use></svg>",
        "<svg><use xlink:href='#plyr-enter-fullscreen'></use></svg>",
        "<span class='plyr__sr-only'>Toggle Fullscreen</span>",
    "</button>",
"</div>"].join("");

          const options = {
            // controls: ['mute', 'volume', 'fullscreen'],
            html: controls,
            clickToPlay: false,
            hideControls: false
          }
          var players = plyr.setup(video, options)[0];
          players.setVolume(0);
          PlyrResSelector.use(players);
        });
      }
    </script>
  </body>
</html>
